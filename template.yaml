# Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance with the License.
# A copy of the License is located at
#    http://aws.amazon.com/apache2.0/
# or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
# either express or implied. See the License for the specific language governing permissions and limitations under the License.

AWSTemplateFormatVersion: "2010-09-09"
Description: This CloudFormation Template deploys a Glue Catalog entry for the MIMIC-IV dataset in the AWS Open Data Registry and an Amazon Sagemaker Notebook instance to run studies against it.

Resources:
  NotebookInstanceRoleE8123527:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: sagemaker.amazonaws.com
        Version: "2012-10-17"
      Description: Amazon Sagemaker role for use with MIMIC-IV
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AWSGlueConsoleFullAccess
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonAthenaFullAccess
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/AmazonS3FullAccess
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/NotebookInstanceRole/Resource
  MIMICNotebookInstance:
    Type: AWS::SageMaker::NotebookInstance
    Properties:
      InstanceType: ml.t3.medium
      RoleArn:
        Fn::GetAtt:
          - NotebookInstanceRoleE8123527
          - Arn
      DefaultCodeRepository: https://github.com/MIT-LCP/mimic-iv-datathon
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/MIMICNotebookInstance
  MIMICIVDB:
    Type: AWS::Glue::Database
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseInput:
        Description: MIMIC-IV Database
        Name: mimiciv
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/MIMICIVDB
  admissions:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv admissions table
        Name: admissions
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: admittime
              Type: timestamp
            - Name: dischtime
              Type: timestamp
            - Name: deathtime
              Type: timestamp
            - Name: admission_type
              Type: string
            - Name: admission_location
              Type: string
            - Name: discharge_location
              Type: string
            - Name: insurance
              Type: string
            - Name: language
              Type: string
            - Name: marital_status
              Type: string
            - Name: race
              Type: string
            - Name: edregtime
              Type: timestamp
            - Name: edouttime
              Type: timestamp
            - Name: hospital_expire_flag
              Type: bigint
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/admissions/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/admissions
  dhcpcs:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv d_hcpcs table
        Name: d_hcpcs
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: code
              Type: string
            - Name: category
              Type: bigint
            - Name: long_description
              Type: string
            - Name: short_description
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/d_hcpcs/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/d_hcpcs
  dicddiagnoses:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv d_icd_diagnoses table
        Name: d_icd_diagnoses
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: icd_code
              Type: string
            - Name: icd_version
              Type: bigint
            - Name: long_title
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/d_icd_diagnoses/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/d_icd_diagnoses
  dicdprocedures:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv d_icd_procedures table
        Name: d_icd_procedures
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: icd_code
              Type: string
            - Name: icd_version
              Type: bigint
            - Name: long_title
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/d_icd_procedures/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/d_icd_procedures
  dlabitems:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv d_labitems table
        Name: d_labitems
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: itemid
              Type: bigint
            - Name: label
              Type: string
            - Name: fluid
              Type: string
            - Name: category
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/d_labitems/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/d_labitems
  diagnosesicd:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv diagnoses_icd table
        Name: diagnoses_icd
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: seq_num
              Type: bigint
            - Name: icd_code
              Type: string
            - Name: icd_version
              Type: bigint
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/diagnoses_icd/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/diagnoses_icd
  drgcodes:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv drgcodes table
        Name: drgcodes
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: drg_type
              Type: string
            - Name: drg_code
              Type: string
            - Name: description
              Type: string
            - Name: drg_severity
              Type: bigint
            - Name: drg_mortality
              Type: bigint
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/drgcodes/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/drgcodes
  emar:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv emar table
        Name: emar
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: emar_id
              Type: string
            - Name: emar_seq
              Type: bigint
            - Name: poe_id
              Type: string
            - Name: pharmacy_id
              Type: bigint
            - Name: charttime
              Type: timestamp
            - Name: medication
              Type: string
            - Name: event_txt
              Type: string
            - Name: scheduletime
              Type: timestamp
            - Name: storetime
              Type: timestamp
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/emar/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/emar
  emardetail:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv emar_detail table
        Name: emar_detail
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: emar_id
              Type: string
            - Name: emar_seq
              Type: bigint
            - Name: parent_field_ordinal
              Type: string
            - Name: administration_type
              Type: string
            - Name: pharmacy_id
              Type: bigint
            - Name: barcode_type
              Type: string
            - Name: reason_for_no_barcode
              Type: string
            - Name: complete_dose_not_given
              Type: string
            - Name: dose_due
              Type: string
            - Name: dose_due_unit
              Type: string
            - Name: dose_given
              Type: string
            - Name: dose_given_unit
              Type: string
            - Name: will_remainder_of_dose_be_given
              Type: string
            - Name: product_amount_given
              Type: string
            - Name: product_unit
              Type: string
            - Name: product_code
              Type: string
            - Name: product_description
              Type: string
            - Name: product_description_other
              Type: string
            - Name: prior_infusion_rate
              Type: string
            - Name: infusion_rate
              Type: string
            - Name: infusion_rate_adjustment
              Type: string
            - Name: infusion_rate_adjustment_amount
              Type: string
            - Name: infusion_rate_unit
              Type: string
            - Name: route
              Type: string
            - Name: infusion_complete
              Type: string
            - Name: completion_interval
              Type: string
            - Name: new_iv_bag_hung
              Type: string
            - Name: continued_infusion_in_other_location
              Type: string
            - Name: restart_interval
              Type: string
            - Name: side
              Type: string
            - Name: site
              Type: string
            - Name: non_formulary_visual_verification
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/emar_detail/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/emar_detail
  hcpcsevents:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv hcpcsevents table
        Name: hcpcsevents
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: chartdate
              Type: date
            - Name: hcpcs_cd
              Type: string
            - Name: seq_num
              Type: bigint
            - Name: short_description
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/hcpcsevents/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/hcpcsevents
  labevents:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv labevents table
        Name: labevents
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: labevent_id
              Type: bigint
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: specimen_id
              Type: bigint
            - Name: itemid
              Type: bigint
            - Name: charttime
              Type: timestamp
            - Name: storetime
              Type: timestamp
            - Name: value
              Type: string
            - Name: valuenum
              Type: float
            - Name: valueuom
              Type: string
            - Name: ref_range_lower
              Type: float
            - Name: ref_range_upper
              Type: float
            - Name: flag
              Type: string
            - Name: priority
              Type: string
            - Name: comments
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/labevents/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/labevents
  microbiologyevents:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv microbiologyevents table
        Name: microbiologyevents
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: microevent_id
              Type: bigint
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: micro_specimen_id
              Type: bigint
            - Name: chartdate
              Type: timestamp
            - Name: charttime
              Type: timestamp
            - Name: spec_itemid
              Type: bigint
            - Name: spec_type_desc
              Type: string
            - Name: test_seq
              Type: bigint
            - Name: storedate
              Type: timestamp
            - Name: storetime
              Type: timestamp
            - Name: test_itemid
              Type: bigint
            - Name: test_name
              Type: string
            - Name: org_itemid
              Type: bigint
            - Name: org_name
              Type: string
            - Name: isolate_num
              Type: bigint
            - Name: quantity
              Type: string
            - Name: ab_itemid
              Type: bigint
            - Name: ab_name
              Type: string
            - Name: dilution_text
              Type: string
            - Name: dilution_comparison
              Type: string
            - Name: dilution_value
              Type: float
            - Name: interpretation
              Type: string
            - Name: comments
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/microbiologyevents/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/microbiologyevents
  omr:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv omr table
        Name: omr
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: chartdate
              Type: date
            - Name: seq_num
              Type: bigint
            - Name: result_name
              Type: string
            - Name: result_value
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/omr/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/omr
  patients:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv patients table
        Name: patients
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: gender
              Type: string
            - Name: anchor_age
              Type: bigint
            - Name: anchor_year
              Type: bigint
            - Name: anchor_year_group
              Type: string
            - Name: dod
              Type: date
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/patients/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/patients
  pharmacy:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv pharmacy table
        Name: pharmacy
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: pharmacy_id
              Type: bigint
            - Name: poe_id
              Type: string
            - Name: starttime
              Type: timestamp
            - Name: stoptime
              Type: timestamp
            - Name: medication
              Type: string
            - Name: proc_type
              Type: string
            - Name: status
              Type: string
            - Name: entertime
              Type: timestamp
            - Name: verifiedtime
              Type: timestamp
            - Name: route
              Type: string
            - Name: frequency
              Type: string
            - Name: disp_sched
              Type: string
            - Name: infusion_type
              Type: string
            - Name: sliding_scale
              Type: string
            - Name: lockout_interval
              Type: string
            - Name: basal_rate
              Type: float
            - Name: one_hr_max
              Type: string
            - Name: doses_per_24_hrs
              Type: float
            - Name: duration
              Type: float
            - Name: duration_interval
              Type: string
            - Name: expiration_value
              Type: bigint
            - Name: expiration_unit
              Type: string
            - Name: expirationdate
              Type: timestamp
            - Name: dispensation
              Type: string
            - Name: fill_quantity
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/pharmacy/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/pharmacy
  poe:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv poe table
        Name: poe
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: poe_id
              Type: string
            - Name: poe_seq
              Type: bigint
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: ordertime
              Type: timestamp
            - Name: order_type
              Type: string
            - Name: order_subtype
              Type: string
            - Name: transaction_type
              Type: string
            - Name: discontinue_of_poe_id
              Type: string
            - Name: discontinued_by_poe_id
              Type: string
            - Name: order_status
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/poe/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/poe
  poedetail:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv poe_detail table
        Name: poe_detail
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: poe_id
              Type: string
            - Name: poe_seq
              Type: bigint
            - Name: subject_id
              Type: bigint
            - Name: field_name
              Type: string
            - Name: field_value
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/poe_detail/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/poe_detail
  prescriptions:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv prescriptions table
        Name: prescriptions
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: pharmacy_id
              Type: bigint
            - Name: poe_id
              Type: string
            - Name: poe_seq
              Type: bigint
            - Name: starttime
              Type: timestamp
            - Name: stoptime
              Type: timestamp
            - Name: drug_type
              Type: string
            - Name: drug
              Type: string
            - Name: formulary_drug_cd
              Type: string
            - Name: gsn
              Type: string
            - Name: ndc
              Type: string
            - Name: prod_strength
              Type: string
            - Name: form_rx
              Type: string
            - Name: dose_val_rx
              Type: string
            - Name: dose_unit_rx
              Type: string
            - Name: form_val_disp
              Type: string
            - Name: form_unit_disp
              Type: string
            - Name: doses_per_24_hrs
              Type: float
            - Name: route
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/prescriptions/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/prescriptions
  proceduresicd:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv procedures_icd table
        Name: procedures_icd
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: seq_num
              Type: bigint
            - Name: chartdate
              Type: date
            - Name: icd_code
              Type: string
            - Name: icd_version
              Type: bigint
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/procedures_icd/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/procedures_icd
  services:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv services table
        Name: services
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: transfertime
              Type: timestamp
            - Name: prev_service
              Type: string
            - Name: curr_service
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/services/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/services
  transfers:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv transfers table
        Name: transfers
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: transfer_id
              Type: bigint
            - Name: eventtype
              Type: string
            - Name: careunit
              Type: string
            - Name: intime
              Type: timestamp
            - Name: outtime
              Type: timestamp
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/hosp/transfers/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/transfers
  chartevents:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv chartevents table
        Name: chartevents
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: stay_id
              Type: bigint
            - Name: charttime
              Type: timestamp
            - Name: storetime
              Type: timestamp
            - Name: itemid
              Type: bigint
            - Name: value
              Type: string
            - Name: valuenum
              Type: float
            - Name: valueuom
              Type: string
            - Name: warning
              Type: bigint
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/icu/chartevents/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/chartevents
  ditems:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv d_items table
        Name: d_items
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: itemid
              Type: bigint
            - Name: label
              Type: string
            - Name: abbreviation
              Type: string
            - Name: linksto
              Type: string
            - Name: category
              Type: string
            - Name: unitname
              Type: string
            - Name: param_type
              Type: string
            - Name: lownormalvalue
              Type: float
            - Name: highnormalvalue
              Type: float
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/icu/d_items/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/d_items
  datetimeevents:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv datetimeevents table
        Name: datetimeevents
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: stay_id
              Type: bigint
            - Name: charttime
              Type: timestamp
            - Name: storetime
              Type: timestamp
            - Name: itemid
              Type: bigint
            - Name: value
              Type: timestamp
            - Name: valueuom
              Type: string
            - Name: warning
              Type: bigint
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/icu/datetimeevents/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/datetimeevents
  icustays:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv icustays table
        Name: icustays
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: stay_id
              Type: bigint
            - Name: first_careunit
              Type: string
            - Name: last_careunit
              Type: string
            - Name: intime
              Type: timestamp
            - Name: outtime
              Type: timestamp
            - Name: los
              Type: float
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/icu/icustays/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/icustays
  ingredientevents:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv ingredientevents table
        Name: ingredientevents
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: stay_id
              Type: bigint
            - Name: starttime
              Type: timestamp
            - Name: endtime
              Type: timestamp
            - Name: storetime
              Type: timestamp
            - Name: itemid
              Type: bigint
            - Name: amount
              Type: float
            - Name: amountuom
              Type: string
            - Name: rate
              Type: float
            - Name: rateuom
              Type: string
            - Name: orderid
              Type: bigint
            - Name: linkorderid
              Type: bigint
            - Name: statusdescription
              Type: string
            - Name: originalamount
              Type: float
            - Name: originalrate
              Type: float
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/icu/ingredientevents/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/ingredientevents
  inputevents:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv inputevents table
        Name: inputevents
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: stay_id
              Type: bigint
            - Name: starttime
              Type: timestamp
            - Name: endtime
              Type: timestamp
            - Name: storetime
              Type: timestamp
            - Name: itemid
              Type: bigint
            - Name: amount
              Type: float
            - Name: amountuom
              Type: string
            - Name: rate
              Type: float
            - Name: rateuom
              Type: string
            - Name: orderid
              Type: bigint
            - Name: linkorderid
              Type: bigint
            - Name: ordercategoryname
              Type: string
            - Name: secondaryordercategoryname
              Type: string
            - Name: ordercomponenttypedescription
              Type: string
            - Name: ordercategorydescription
              Type: string
            - Name: patientweight
              Type: float
            - Name: totalamount
              Type: float
            - Name: totalamountuom
              Type: string
            - Name: isopenbag
              Type: bigint
            - Name: continueinnextdept
              Type: bigint
            - Name: statusdescription
              Type: string
            - Name: originalamount
              Type: float
            - Name: originalrate
              Type: float
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/icu/inputevents/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/inputevents
  outputevents:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv outputevents table
        Name: outputevents
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: stay_id
              Type: bigint
            - Name: charttime
              Type: timestamp
            - Name: storetime
              Type: timestamp
            - Name: itemid
              Type: bigint
            - Name: value
              Type: float
            - Name: valueuom
              Type: string
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/icu/outputevents/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/outputevents
  procedureevents:
    Type: AWS::Glue::Table
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseName:
        Ref: MIMICIVDB
      TableInput:
        Description: mimic-iv procedureevents table
        Name: procedureevents
        Parameters:
          classification: parquet
          useGlueParquetWriter: "true"
        StorageDescriptor:
          Columns:
            - Name: subject_id
              Type: bigint
            - Name: hadm_id
              Type: bigint
            - Name: stay_id
              Type: bigint
            - Name: starttime
              Type: timestamp
            - Name: endtime
              Type: timestamp
            - Name: storetime
              Type: timestamp
            - Name: itemid
              Type: bigint
            - Name: value
              Type: float
            - Name: valueuom
              Type: string
            - Name: location
              Type: string
            - Name: locationcategory
              Type: string
            - Name: orderid
              Type: bigint
            - Name: linkorderid
              Type: bigint
            - Name: ordercategoryname
              Type: string
            - Name: ordercategorydescription
              Type: string
            - Name: patientweight
              Type: float
            - Name: isopenbag
              Type: bigint
            - Name: continueinnextdept
              Type: bigint
            - Name: statusdescription
              Type: string
            - Name: originalamount
              Type: float
            - Name: originalrate
              Type: float
          InputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat
          Location: s3://mimiciv-physionet/parquet/icu/procedureevents/
          OutputFormat: org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat
          SerdeInfo:
            SerializationLibrary: org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe
        TableType: EXTERNAL_TABLE
    Metadata:
      aws:cdk:path: MimicivParquetDatabaseStack/procedureevents

Outputs:
  MIMICJupyterNotebook:
    Description: Jupyter notebook
    Value:
      Fn::Join:
        - ""
        - - https://
          - Ref: AWS::Region
          - .console.aws.amazon.com/sagemaker/home?region=
          - Ref: AWS::Region
          - "#/notebook-instances/openNotebook/"
          - Fn::GetAtt:
              - MIMICNotebookInstance
              - NotebookInstanceName
          - ?view=classic
  MIMICAthenaforSQL:
    Description: Athena web query editor
    Value:
      Fn::Join:
        - ""
        - - https://
          - Ref: AWS::Region
          - .console.aws.amazon.com/athena/home?force&region=
          - Ref: AWS::Region
          - "#/query-editor"
